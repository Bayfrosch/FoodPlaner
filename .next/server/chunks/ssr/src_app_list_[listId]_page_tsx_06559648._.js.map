{"version":3,"sources":["../../../../src/app/list/%5BlistId%5D/page.tsx","../../../../src/services/sse.ts","../../../../src/components/ShareListModal.tsx","../../../../src/components/ListItemWithCategory.tsx"],"sourcesContent":["'use client';\n\nimport { useEffect, useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useParams } from 'next/navigation';\nimport { items as itemsApi, lists, auth, collaborators } from '@/api';\nimport { sseService } from '@/services/sse';\nimport ShareListModal from '@/components/ShareListModal';\nimport ListItemWithCategory from '@/components/ListItemWithCategory';\n\ninterface Item {\n    id: number;\n    name: string;\n    category: string | null;\n    completed: boolean;\n    created_at: string;\n}\n\ninterface List {\n    id: number;\n    title: string;\n    description: string;\n}\n\ninterface UserRole {\n    isOwner: boolean;\n    isEditor: boolean;\n    isViewer: boolean;\n}\n\ninterface Collaborator {\n    id: number;\n    userId: number;\n    role: string;\n    status: string;\n    user: {\n        id: number;\n        username: string;\n    };\n}\n\nexport default function ListDetailPage() {\n    const router = useRouter();\n    const params = useParams();\n    const listId = params?.listId as string;\n    \n    const [list, setList] = useState<List | null>(null);\n    const [items, setItems] = useState<Item[]>([]);\n    const [newItemName, setNewItemName] = useState('');\n    const [loading, setLoading] = useState(false);\n    const [error, setError] = useState('');\n    const [showShareModal, setShowShareModal] = useState(false);\n    const [customCategories, setCustomCategories] = useState<string[]>([]);\n    const [isClient, setIsClient] = useState(false);\n    const [userRole, setUserRole] = useState<UserRole>({ isOwner: false, isEditor: true, isViewer: false });\n    const [draggedCategory, setDraggedCategory] = useState<string | null>(null);\n    const [savingCategoryOrder, setSavingCategoryOrder] = useState(false);\n    const [currentUserCollaborator, setCurrentUserCollaborator] = useState<Collaborator | null>(null);\n    const [userId, setUserId] = useState<number | null>(null);\n\n    useEffect(() => {\n        setIsClient(true);\n    }, []);\n\n    useEffect(() => {\n        if (!isClient || !listId) return;\n        fetchData();\n\n        // Subscribe to SSE updates for this list\n        const listIdNum = Number(listId);\n        const unsubscribe = sseService.subscribe(listIdNum, (message) => {\n            // Handle category updates without full refresh\n            if (message.type === 'category_updated') {\n                console.log(`Category updated for item: ${message.itemName} -> ${message.category}`);\n                // Add category to list if it's new\n                setCustomCategories(prev => {\n                    if (message.category && !prev.includes(message.category)) {\n                        return [...prev, message.category].sort();\n                    }\n                    return prev;\n                });\n            } else if (message.type !== 'connected') {\n                // For other updates, refresh data\n                console.log(`List ${listId} updated - refreshing data`);\n                fetchData();\n            }\n        });\n\n        return () => {\n            unsubscribe();\n        };\n    }, [listId, isClient]);\n\n    const fetchData = async () => {\n        try {\n            setLoading(true);\n            const listId_num = Number(listId)\n\n            const listData = await lists.getById(listId_num);\n            setList(listData);\n\n            // Fetch user info to determine role\n            try {\n                const me = await auth.me();\n                if (me) {\n                    setUserId(me.id);\n                    const collabs = await collaborators.getAll(listId_num);\n                    const isOwner = listData.ownerId === me.id;\n                    const collaborator = collabs?.find((c: any) => c.userId === me.id);\n                    setCurrentUserCollaborator(collaborator || null);\n                    const isEditor = collaborator?.role === 'editor';\n                    const isViewer = collaborator?.role === 'viewer' || (!isOwner && collaborator?.role !== 'editor');\n                    \n                    setUserRole({ isOwner, isEditor, isViewer });\n                }\n            } catch (err) {\n                console.log('Could not fetch user role, assuming editor');\n                setUserRole({ isOwner: false, isEditor: true, isViewer: false });\n            }\n\n            const itemsData = await itemsApi.getAll(listId_num);\n            setItems(itemsData);\n            \n            // Lade alle persistenten Kategorien von diesem List\n            try {\n                const categories = await lists.getCategories(listId_num);\n                setCustomCategories(categories);\n            } catch (err) {\n                // Falls Fehler beim Laden der Kategorien, nutze die aus den Items\n                const categories = itemsData\n                    .filter((item: any) => item.category)\n                    .map((item: any) => item.category)\n                    .filter((cat: string, index: number, self: string[]) => self.indexOf(cat) === index);\n                \n                setCustomCategories(categories);\n            }\n        } catch (err) {\n            const errorMessage = err instanceof Error ? err.message : 'Fehler beim Laden';\n            // Only show non-permission errors\n            if (!errorMessage.includes('Forbidden')) {\n                setError(errorMessage);\n            }\n            console.error(err);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleLeaveList = async () => {\n        if (!listId || !currentUserCollaborator) return;\n\n        if (!confirm('Möchtest du diese Liste wirklich verlassen?')) {\n            return;\n        }\n\n        try {\n            await collaborators.remove(Number(listId), currentUserCollaborator.id);\n            router.push('/dashboard');\n        } catch (err) {\n            const errorMessage = err instanceof Error ? err.message : 'Fehler beim Verlassen der Liste';\n            setError(errorMessage);\n        }\n    };\n\n    const handleAcceptInvitation = async () => {\n        if (!listId || !currentUserCollaborator) return;\n\n        try {\n            const updated = await collaborators.accept(Number(listId), currentUserCollaborator.id);\n            setCurrentUserCollaborator(updated);\n            setError('');\n        } catch (err) {\n            const errorMessage = err instanceof Error ? err.message : 'Fehler beim Akzeptieren der Einladung';\n            setError(errorMessage);\n        }\n    };\n\n    const handleAddItem = async (e: React.FormEvent) => {\n        e.preventDefault();\n        if (!newItemName.trim() || !listId) return;\n\n        if (userRole.isViewer) {\n            setError('Du kannst dieser Liste keine Artikel hinzufügen (Viewer-Zugriff)');\n            return;\n        }\n\n        try {\n            await itemsApi.create(Number(listId), newItemName);\n            setNewItemName('');\n            fetchData();\n        } catch (err) {\n            const errorMessage = err instanceof Error ? err.message : 'Fehler beim Hinzufügen';\n            if (errorMessage.includes('Forbidden')) {\n                setError('Du darfst diese Liste nicht bearbeiten');\n            } else {\n                setError(errorMessage);\n            }\n        }\n    };\n\n    const handleToggleItem = async (itemId: number, completed: boolean) => {\n        if (!listId) return;\n\n        try {\n            await itemsApi.update(Number(listId), itemId, !completed);\n            fetchData();\n        } catch (err) {\n            setError(err instanceof Error ? err.message : 'Fehler beim Aktualisieren');\n        }\n    };\n\n    const handleDeleteItem = async (itemId: number) => {\n        if (!listId) return;\n\n        try {\n            await itemsApi.delete(Number(listId), itemId);\n            fetchData();\n        } catch (err) {\n            setError(err instanceof Error ? err.message : 'Fehler beim Löschen');\n        }\n    };\n\n    const handleAddCategory = (categoryName: string) => {\n        if (!customCategories.includes(categoryName)) {\n            setCustomCategories([...customCategories, categoryName]);\n        }\n    };\n\n    const handleDeleteCategory = async (categoryName: string) => {\n        if (!listId) return;\n\n        try {\n            await lists.deleteCategory(Number(listId), categoryName);\n            setCustomCategories(customCategories.filter(cat => cat !== categoryName));\n            fetchData();\n        } catch (err) {\n            setError(err instanceof Error ? err.message : 'Fehler beim Löschen der Kategorie');\n        }\n    };\n\n    const handleCategoryDragStart = (e: React.DragEvent<HTMLDivElement>, category: string) => {\n        if (userRole.isViewer) return;\n        setDraggedCategory(category);\n        e.dataTransfer.effectAllowed = 'move';\n    };\n\n    const handleCategoryDragOver = (e: React.DragEvent<HTMLDivElement>) => {\n        e.preventDefault();\n        e.dataTransfer.dropEffect = 'move';\n    };\n\n    const handleCategoryDrop = async (e: React.DragEvent<HTMLDivElement>, targetCategory: string) => {\n        e.preventDefault();\n        if (!draggedCategory || draggedCategory === targetCategory || userRole.isViewer) {\n            setDraggedCategory(null);\n            return;\n        }\n\n        const draggedIndex = customCategories.indexOf(draggedCategory);\n        const targetIndex = customCategories.indexOf(targetCategory);\n\n        if (draggedIndex === -1 || targetIndex === -1) {\n            setDraggedCategory(null);\n            return;\n        }\n\n        const newCategories = [...customCategories];\n        newCategories.splice(draggedIndex, 1);\n        newCategories.splice(targetIndex, 0, draggedCategory);\n\n        setCustomCategories(newCategories);\n        setDraggedCategory(null);\n\n        // Save to backend\n        setSavingCategoryOrder(true);\n        try {\n            await lists.updateCategoryOrder(Number(listId), newCategories);\n        } catch (err) {\n            // Revert on error\n            setCustomCategories(customCategories);\n            setError(err instanceof Error ? err.message : 'Fehler beim Speichern der Kategorie-Reihenfolge');\n        } finally {\n            setSavingCategoryOrder(false);\n        }\n    };\n\n    if (!list) {\n        return (\n            <div className=\"min-h-screen bg-[#0a0a0f] flex items-center justify-center\">\n                <p className=\"text-gray-400 text-lg\">Liste nicht gefunden</p>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"min-h-screen bg-[#0a0a0f] flex flex-col\">\n            {/* Header */}\n            <header className=\"bg-gradient-to-b from-[#14141f] to-transparent border-b border-[#2d2d3f]/50\">\n                <div className=\"max-w-4xl mx-auto px-3 sm:px-6 py-4 sm:py-6\">\n                    <div className=\"flex justify-between items-center gap-2 sm:gap-4 mb-3 sm:mb-4\">\n                        <button\n                            onClick={() => router.push('/dashboard')}\n                            className=\"inline-flex items-center gap-1 sm:gap-2 text-purple-400 hover:text-purple-300 text-xs sm:text-sm font-medium transition-all group flex-shrink-0\"\n                        >\n                            <svg className=\"w-4 h-4 group-hover:-translate-x-1 transition-transform\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n                            </svg>\n                            <span className=\"hidden sm:inline\">Zurück zu Listen</span>\n                            <span className=\"sm:hidden\">Zurück</span>\n                        </button>\n                        <div className=\"flex gap-1 sm:gap-3 flex-shrink-0\">\n                            {currentUserCollaborator && currentUserCollaborator.status === 'pending' && (\n                                <button\n                                    onClick={handleAcceptInvitation}\n                                    className=\"inline-flex items-center gap-1 sm:gap-2 text-green-400 hover:text-green-300 text-xs sm:text-sm font-medium transition-all group\"\n                                    title=\"Einladung akzeptieren\"\n                                >\n                                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 13l4 4L19 7\" />\n                                    </svg>\n                                    <span className=\"hidden sm:inline\">Akzeptieren</span>\n                                </button>\n                            )}\n                            {currentUserCollaborator && !userRole.isOwner && (\n                                <button\n                                    onClick={handleLeaveList}\n                                    className=\"inline-flex items-center gap-1 sm:gap-2 text-red-400 hover:text-red-300 text-xs sm:text-sm font-medium transition-all group\"\n                                    title=\"Liste verlassen\"\n                                >\n                                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1\" />\n                                    </svg>\n                                    <span className=\"hidden sm:inline\">Verlassen</span>\n                                </button>\n                            )}\n                            {userRole.isOwner && (\n                                <button\n                                    onClick={() => setShowShareModal(true)}\n                                    className=\"inline-flex items-center gap-1 sm:gap-2 text-purple-400 hover:text-purple-300 text-xs sm:text-sm font-medium transition-all group\"\n                                    title=\"Liste teilen\"\n                                >\n                                    <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 19l9 2-9-18-9 18 9-2zm0 0v-8\" />\n                                    </svg>\n                                    <span className=\"hidden sm:inline\">Teilen</span>\n                                </button>\n                            )}\n                        </div>\n                    </div>\n                    <div className=\"flex items-center justify-center gap-3 sm:gap-4\">\n                        <div className=\"flex-1 text-center\">\n                            <h1 className=\"text-lg sm:text-3xl font-bold bg-gradient-to-r from-white to-gray-300 bg-clip-text text-transparent mb-1 sm:mb-2 truncate\">{list.title}</h1>\n                            {list.description && (\n                                <p className=\"text-gray-400 text-xs sm:text-sm line-clamp-2\">{list.description}</p>\n                            )}\n                        </div>\n                    </div>\n                </div>\n            </header>\n\n            {/* Main Content */}\n            <main className=\"flex-1 flex flex-col items-center max-w-4xl mx-auto px-3 sm:px-6 py-4 sm:py-8 w-full\">\n                <div className=\"w-full max-w-3xl\">\n                {error && (\n                    <div className=\"bg-red-500/10 border border-red-500/30 text-red-400 px-3 sm:px-4 py-2 sm:py-3 rounded-lg sm:rounded-2xl mb-4 sm:mb-6 flex items-center justify-between backdrop-blur-sm\">\n                        <span className=\"text-xs sm:text-sm\">{error}</span>\n                        <button\n                            onClick={() => setError('')}\n                            className=\"text-red-400 hover:text-red-300 font-bold ml-2 flex-shrink-0\"\n                        >\n                            ✕\n                        </button>\n                    </div>\n                )}\n\n                {/* Add Item Form */}\n                <form onSubmit={handleAddItem} className=\"mb-4 sm:mb-6 w-full\">\n                    <div className=\"flex gap-2 sm:gap-3\">\n                        <div className=\"relative flex-1\">\n                            <input\n                                type=\"text\"\n                                value={newItemName}\n                                onChange={(e) => setNewItemName(e.target.value)}\n                                placeholder=\"Neuen Artikel hinzufügen...\"\n                                disabled={userRole.isViewer}\n                                className=\"w-full px-3 sm:px-5 py-3 sm:py-4 bg-[#14141f] border border-[#2d2d3f] rounded-lg sm:rounded-2xl text-white placeholder-gray-500 focus:outline-none focus:border-purple-500 focus:ring-2 focus:ring-purple-500/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed text-sm\"\n                            />\n                        </div>\n                        <button\n                            type=\"submit\"\n                            disabled={userRole.isViewer}\n                            className=\"bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-bold py-3 sm:py-4 px-3 sm:px-6 rounded-lg sm:rounded-2xl transition-all shadow-lg shadow-purple-500/40 hover:shadow-purple-500/60 hover:scale-[1.03] active:scale-95 flex items-center gap-1 sm:gap-2 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 flex-shrink-0\"\n                        >\n                            <svg className=\"w-4 h-4 sm:w-5 sm:h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 4v16m8-8H4\" />\n                            </svg>\n                            <span className=\"hidden sm:inline\">Hinzufügen</span>\n                        </button>\n                    </div>\n                    {userRole.isViewer && (\n                        <p className=\"text-yellow-500 text-xs sm:text-sm mt-2\">Du hast nur Zugriff als Zuschauer</p>\n                    )}\n                </form>\n\n                {/* Items List */}\n                {items.length === 0 ? (\n                    <div className=\"text-center py-12 sm:py-20 bg-gradient-to-br from-[#14141f] to-[#1a1a2e] border border-[#2d2d3f] rounded-xl sm:rounded-2xl\">\n                        <h3 className=\"text-base sm:text-lg font-semibold text-white mb-2\">Liste ist leer</h3>\n                        <p className=\"text-gray-400 text-xs sm:text-sm\">Füge deinen ersten Artikel hinzu</p>\n                    </div>\n                ) : (\n                    <div className=\"space-y-3 sm:space-y-4 w-full\">\n                        {(() => {\n                            // Gruppiere Items nach Kategorie\n                            const grouped = items.reduce((acc: any, item) => {\n                                const cat = item.category || 'Ohne Kategorie';\n                                if (!acc[cat]) acc[cat] = [];\n                                acc[cat].push(item);\n                                return acc;\n                            }, {});\n\n                            // Sortiere Items innerhalb jeder Kategorie (nicht erledigte zuerst, erledigte am Ende)\n                            Object.keys(grouped).forEach((category) => {\n                                grouped[category].sort((a: Item, b: Item) => {\n                                    if (a.completed === b.completed) {\n                                        return 0;\n                                    }\n                                    return a.completed ? 1 : -1;\n                                });\n                            });\n\n                            // Sortiere Kategorien nach custom order, dann alphabetisch\n                            const sortedCategories = Object.keys(grouped).sort((a, b) => {\n                                const aIndex = customCategories.indexOf(a);\n                                const bIndex = customCategories.indexOf(b);\n                                \n                                // If both are in custom order, use that order\n                                if (aIndex !== -1 && bIndex !== -1) {\n                                    return aIndex - bIndex;\n                                }\n                                // If only one is in custom order, it goes first\n                                if (aIndex !== -1) return -1;\n                                if (bIndex !== -1) return 1;\n                                \n                                // For categories not in custom order, put \"Ohne Kategorie\" last\n                                if (a === 'Ohne Kategorie') return 1;\n                                if (b === 'Ohne Kategorie') return -1;\n                                return a.localeCompare(b);\n                            });\n\n                            return sortedCategories.map((category) => (\n                                <div \n                                    key={category} \n                                    className=\"bg-gradient-to-br from-[#14141f] to-[#1a1a2e] border border-[#2d2d3f] rounded-2xl shadow-xl\"\n                                    onDragOver={handleCategoryDragOver}\n                                    onDrop={(e) => handleCategoryDrop(e, category)}\n                                >\n                                    <div \n                                        draggable={!userRole.isViewer}\n                                        onDragStart={(e) => handleCategoryDragStart(e, category)}\n                                        className={`bg-purple-500/10 border-b border-[#2d2d3f] px-4 py-3 rounded-t-2xl flex items-center gap-3 transition-all ${\n                                            !userRole.isViewer ? 'cursor-move hover:bg-purple-500/20' : ''\n                                        } ${draggedCategory === category ? 'opacity-50 bg-purple-500/30' : ''}`}\n                                        title={userRole.isViewer ? '' : 'Kategorie ziehen zum Umsortieren'}\n                                    >\n                                        {!userRole.isViewer && (\n                                            <svg className=\"w-5 h-5 text-gray-500 flex-shrink-0\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                                                <path d=\"M9 3h2v2H9V3zm0 4h2v2H9V7zm0 4h2v2H9v-2zm4-8h2v2h-2V3zm0 4h2v2h-2V7zm0 4h2v2h-2v-2z\" />\n                                            </svg>\n                                        )}\n                                        <h3 className=\"text-sm font-semibold text-purple-400 flex-1\">{category}</h3>\n                                    </div>\n                                    <ul className=\"divide-y divide-[#2d2d3f]\">\n                                        {grouped[category].map((item: Item) => (\n                                            <ListItemWithCategory\n                                                key={item.id}\n                                                id={item.id}\n                                                name={item.name}\n                                                category={item.category}\n                                                completed={item.completed}\n                                                listId={Number(listId)}\n                                                customCategories={customCategories}\n                                                recipeName={(item as any).recipeName}\n                                                onToggle={handleToggleItem}\n                                                onDelete={handleDeleteItem}\n                                                onCategoryChange={fetchData}\n                                                onAddCategory={handleAddCategory}\n                                                onDeleteCategory={handleDeleteCategory}\n                                                isViewer={userRole.isViewer}\n                                            />\n                                        ))}\n                                    </ul>\n                                </div>\n                            ));\n                        })()}\n                    </div>\n                )}\n                </div>\n            </main>\n\n            {/* Share Modal */}\n            {showShareModal && listId && (\n                <ShareListModal\n                    listId={Number(listId)}\n                    onClose={() => setShowShareModal(false)}\n                />\n            )}\n        </div>\n    );\n}\n","interface SSEMessage {\n  type: string;\n  [key: string]: any;\n}\n\ntype SSECallback = (message: SSEMessage) => void;\n\nclass SSEService {\n  private abortController: AbortController | null = null;\n  private listId: number | null = null;\n  private callbacks: Set<SSECallback> = new Set();\n  private reconnectAttempts = 0;\n  private maxReconnectAttempts = 5;\n  private reconnectDelay = 1000;\n  private isAborting = false;\n\n  public subscribe(listId: number, callback: SSECallback): () => void {\n    this.callbacks.add(callback);\n\n    // If not already connected to this list, connect now\n    if (this.listId !== listId || !this.abortController) {\n      this.connect(listId);\n    }\n\n    // Return unsubscribe function\n    return () => {\n      this.callbacks.delete(callback);\n      // Close connection if no more subscribers\n      if (this.callbacks.size === 0) {\n        this.disconnect();\n      }\n    };\n  }\n\n  private async connect(listId: number): Promise<void> {\n    this.listId = listId;\n\n    // Close existing connection safely\n    if (this.abortController && !this.isAborting) {\n      this.isAborting = true;\n      try {\n        // Check if the controller is already aborted before aborting\n        if (this.abortController.signal.aborted === false) {\n          this.abortController.abort();\n        }\n      } catch (error) {\n        // Ignore abort errors - controller might already be aborted\n        console.debug('[SSE Client] Abort error (expected):', error instanceof Error ? error.message : String(error));\n      }\n      this.isAborting = false;\n    }\n\n    this.abortController = new AbortController();\n\n    const baseUrl = typeof window !== 'undefined' ? window.location.origin : '';\n    const token = typeof window !== 'undefined' ? localStorage.getItem('token') : null;\n    \n    const url = `${baseUrl}/api/lists/${listId}/updates`;\n    \n    console.log('[SSE Client] Attempting to connect to', url);\n\n    try {\n      const response = await fetch(url, {\n        method: 'GET',\n        headers: {\n          'Authorization': `Bearer ${token}`,\n        },\n        signal: this.abortController.signal,\n      });\n\n      console.log('[SSE Client] Response status:', response.status, response.statusText);\n\n      if (!response.ok) {\n        const errorText = await response.text();\n        console.error('[SSE Client] HTTP error:', response.status, errorText);\n        this.handleConnectionError();\n        return;\n      }\n\n      if (!response.body) {\n        console.error('[SSE Client] No response body');\n        this.handleConnectionError();\n        return;\n      }\n\n      console.log('[SSE Client] Connected to list', listId);\n      await this.readStream(response.body);\n    } catch (error) {\n      if (error instanceof Error && error.name === 'AbortError') {\n        console.log('[SSE Client] Connection aborted');\n      } else if (error instanceof TypeError && error.message.includes('BodyStreamBuffer')) {\n        // Expected error when stream is aborted while being read\n        console.log('[SSE Client] Stream was aborted during read');\n      } else {\n        console.error('[SSE Client] Connection error:', error);\n        this.handleConnectionError();\n      }\n    }\n  }\n\n  private async readStream(body: ReadableStream<Uint8Array>): Promise<void> {\n    const reader = body.getReader();\n    const decoder = new TextDecoder();\n    let buffer = '';\n\n    try {\n      while (true) {\n        // Check if we're being aborted\n        if (this.abortController?.signal.aborted) {\n          console.log('[SSE Client] Stream aborted, stopping read');\n          break;\n        }\n\n        const { done, value } = await reader.read();\n        if (done) {\n          console.log('[SSE Client] Stream ended');\n          this.handleConnectionError();\n          break;\n        }\n\n        buffer += decoder.decode(value, { stream: true });\n        const lines = buffer.split('\\n');\n\n        // Keep the last incomplete line in the buffer\n        buffer = lines.pop() || '';\n\n        for (const line of lines) {\n          if (line.startsWith('data: ')) {\n            const data = line.slice(6);\n            try {\n              const message: SSEMessage = JSON.parse(data);\n              this.broadcastToCallbacks(message);\n              \n              // Reset reconnect attempts on successful message\n              this.reconnectAttempts = 0;\n            } catch (error) {\n              console.error('[SSE Client] Failed to parse message:', error, 'raw:', data);\n            }\n          }\n        }\n      }\n    } catch (error) {\n      // Check if this is an expected abort error\n      if (error instanceof Error) {\n        if (error.name === 'AbortError' || error.message.includes('aborted')) {\n          console.log('[SSE Client] Stream read aborted');\n          return;\n        } else if (error.message.includes('BodyStreamBuffer')) {\n          console.log('[SSE Client] Stream buffer was aborted (expected)');\n          return;\n        }\n      }\n      console.error('[SSE Client] Stream read error:', error);\n      this.handleConnectionError();\n    } finally {\n      try {\n        reader.releaseLock();\n      } catch (error) {\n        // Ignore errors when releasing reader lock\n        console.debug('[SSE Client] Reader lock release error (expected):', error instanceof Error ? error.message : String(error));\n      }\n    }\n  }\n\n  private handleConnectionError(): void {\n    // Attempt to reconnect with exponential backoff\n    if (this.reconnectAttempts < this.maxReconnectAttempts && this.listId) {\n      const delay = this.reconnectDelay * Math.pow(2, this.reconnectAttempts);\n      console.log('[SSE Client] Reconnecting in ${delay}ms (attempt ${this.reconnectAttempts + 1}/${this.maxReconnectAttempts})');\n      \n      setTimeout(() => {\n        this.reconnectAttempts++;\n        if (this.listId) {\n          this.connect(this.listId);\n        }\n      }, delay);\n    } else {\n      console.error('[SSE Client] Connection failed after maximum reconnection attempts');\n    }\n  }\n\n  private broadcastToCallbacks(message: SSEMessage): void {\n    this.callbacks.forEach((callback) => {\n      try {\n        callback(message);\n      } catch (error) {\n        console.error('[SSE Client] Error in callback:', error);\n      }\n    });\n  }\n\n  public disconnect(): void {\n    if (this.abortController && !this.isAborting) {\n      this.isAborting = true;\n      try {\n        if (this.abortController.signal.aborted === false) {\n          this.abortController.abort();\n        }\n      } catch (error) {\n        // Ignore errors when aborting - controller might already be aborted\n        console.debug('[SSE Client] Disconnect abort error (expected):', error instanceof Error ? error.message : String(error));\n      }\n      this.isAborting = false;\n      this.abortController = null;\n    }\n    this.listId = null;\n    this.callbacks.clear();\n    this.reconnectAttempts = 0;\n    console.log('[SSE Client] Disconnected');\n  }\n\n  public isConnected(): boolean {\n    return this.abortController !== null;\n  }\n}\n\n// Export singleton instance\nexport const sseService = new SSEService();\n","import { useState, useEffect } from 'react';\nimport { collaborators, lists, auth } from '../api';\n\ninterface Collaborator {\n  id: number;\n  user_id: number;\n  username: string;\n  role: 'editor' | 'viewer';\n}\n\ninterface ShareListModalProps {\n  listId: number;\n  onClose: () => void;\n}\n\nexport default function ShareListModal({ listId, onClose }: ShareListModalProps) {\n  const [collaboratorsList, setCollaboratorsList] = useState<Collaborator[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const [success, setSuccess] = useState('');\n  const [isOwner, setIsOwner] = useState(false);\n  const [isOwnerLoading, setIsOwnerLoading] = useState(true);\n  \n  const [inviteUsername, setInviteUsername] = useState('');\n  const [inviteRole, setInviteRole] = useState<'editor' | 'viewer'>('viewer');\n  const [inviting, setInviting] = useState(false);\n\n  useEffect(() => {\n    checkOwnership();\n    fetchCollaborators();\n  }, [listId]);\n\n  const checkOwnership = async () => {\n    try {\n      setIsOwnerLoading(true);\n      const [me, list] = await Promise.all([\n        auth.me(),\n        lists.getById(listId)\n      ]);\n      setIsOwner(me.id === list.ownerId);\n    } catch (err) {\n      console.error('Could not check ownership:', err);\n      setIsOwner(false);\n    } finally {\n      setIsOwnerLoading(false);\n    }\n  };\n\n  const fetchCollaborators = async () => {\n    try {\n      setLoading(true);\n      const data = await collaborators.getAll(listId);\n      setCollaboratorsList(data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Fehler beim Laden der Kollaboratoren');\n      console.error(err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleInvite = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setError('');\n    setSuccess('');\n\n    if (!inviteUsername.trim()) {\n      setError('Benutzername erforderlich');\n      return;\n    }\n\n    setInviting(true);\n    try {\n      // Backend wird Benutzername in User-ID umwandeln\n      await collaborators.invite(listId, inviteUsername, inviteRole);\n      setSuccess('Einladung erfolgreich versendet!');\n      setInviteUsername('');\n      setInviteRole('viewer');\n      // Neu laden\n      setTimeout(() => fetchCollaborators(), 500);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Fehler beim Versenden der Einladung');\n    } finally {\n      setInviting(false);\n    }\n  };\n\n  const handleRemoveCollaborator = async (collaboratorId: number) => {\n    if (!confirm('Diesen Nutzer entfernen?')) return;\n\n    try {\n      await collaborators.remove(listId, collaboratorId);\n      setSuccess('Nutzer entfernt');\n      fetchCollaborators();\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Fehler beim Entfernen');\n    }\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\n      <div className=\"bg-gradient-to-br from-[#14141f]/95 to-[#1a1a2e]/95 backdrop-blur-xl border border-purple-500/30 rounded-3xl max-w-md w-full shadow-2xl shadow-purple-500/30\">\n        <div className=\"p-8\">\n          <div className=\"flex items-center justify-between mb-6\">\n            <h2 className=\"text-2xl font-bold text-white\">Liste teilen</h2>\n            <button\n              onClick={onClose}\n              className=\"text-gray-400 hover:text-gray-300 text-lg font-bold\"\n            >\n              Close\n            </button>\n          </div>\n\n          {error && (\n            <div className=\"bg-red-500/10 border border-red-500/30 text-red-400 px-4 py-3 rounded-xl text-sm mb-4 backdrop-blur-sm\">\n              {error}\n            </div>\n          )}\n\n          {success && (\n            <div className=\"bg-green-500/10 border border-green-500/30 text-green-400 px-4 py-3 rounded-xl text-sm mb-4 backdrop-blur-sm\">\n              {success}\n            </div>\n          )}\n\n          {!isOwnerLoading && !isOwner && (\n            <div className=\"bg-yellow-500/10 border border-yellow-500/30 text-yellow-400 px-4 py-3 rounded-xl text-sm mb-4 backdrop-blur-sm\">\n              Du kannst Kollaboratoren nur hinzufügen, wenn du der Besitzer der Liste bist.\n            </div>\n          )}\n\n          {/* Einladungsformular */}\n          {isOwner && (\n            <form onSubmit={handleInvite} className=\"mb-6 pb-6 border-b border-purple-500/20\">\n              <label className=\"block text-gray-300 text-sm font-medium mb-2\">Benutzername</label>\n              <input\n                type=\"text\"\n                value={inviteUsername}\n                onChange={(e) => setInviteUsername(e.target.value)}\n                placeholder=\"benutzername\"\n                className=\"w-full px-4 py-2 bg-[#1a1a2e] border border-purple-500/30 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-purple-400 focus:ring-2 focus:ring-purple-500/30 transition-all mb-3\"\n                required\n              />\n\n              <label className=\"block text-gray-300 text-sm font-medium mb-2\">Berechtigung</label>\n              <select\n                value={inviteRole}\n                onChange={(e) => setInviteRole(e.target.value as 'editor' | 'viewer')}\n                className=\"w-full px-4 py-2 bg-[#1a1a2e] border border-purple-500/30 rounded-xl text-white focus:outline-none focus:border-purple-400 focus:ring-2 focus:ring-purple-500/30 transition-all mb-4\"\n              >\n                <option value=\"viewer\">Betrachter (nur lesen)</option>\n                <option value=\"editor\">Bearbeiter (bearbeiten)</option>\n              </select>\n\n              <button\n                type=\"submit\"\n                disabled={inviting}\n                className=\"w-full px-4 py-2 text-white bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 disabled:from-gray-600 disabled:to-gray-700 rounded-xl font-bold transition-all shadow-lg shadow-purple-500/40\"\n              >\n                {inviting ? 'Wird eingeladen...' : 'Einladen'}\n              </button>\n            </form>\n          )}\n\n          {/* Kollaboratoren */}\n          <div>\n            <h3 className=\"text-sm font-bold text-gray-300 mb-3\">\n              Kollaboratoren ({collaboratorsList.length})\n            </h3>\n\n            {loading ? (\n              <p className=\"text-gray-400 text-sm\">Lädt...</p>\n            ) : collaboratorsList.length === 0 ? (\n              <p className=\"text-gray-400 text-sm\">Keine Kollaboratoren</p>\n            ) : (\n              <div className=\"space-y-2 max-h-64 overflow-y-auto\">\n                {collaboratorsList.map((collab) => (\n                  <div\n                    key={collab.id}\n                    className=\"flex items-center justify-between p-3 bg-[#1a1a2e] border border-purple-500/20 rounded-xl\"\n                  >\n                    <div>\n                      <p className=\"text-white text-sm font-medium\">{collab.username}</p>\n                      <p className=\"text-gray-400 text-xs\">\n                        {collab.role === 'editor' ? 'Bearbeiter' : 'Betrachter'}\n                      </p>\n                    </div>\n                    <button\n                      onClick={() => handleRemoveCollaborator(collab.id)}\n                      className=\"p-1 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded transition-all\"\n                      title=\"Entfernen\"\n                    >\n                      <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                        <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n                      </svg>\n                    </button>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import { useState, useRef, useEffect } from 'react';\nimport { items as itemsApi, lists } from '../api';\n\ninterface ListItemWithCategoryProps {\n  id: number;\n  name: string;\n  category: string | null;\n  completed: boolean;\n  listId: number;\n  customCategories: string[];\n  recipeName?: string | null;\n  onToggle: (itemId: number, completed: boolean) => void;\n  onDelete: (itemId: number) => void;\n  onCategoryChange: () => void;\n  onAddCategory: (categoryName: string) => void;\n  onDeleteCategory: (categoryName: string) => void;\n  isViewer?: boolean;\n}\n\nconst DEFAULT_CATEGORIES: string[] = [];\n\nexport default function ListItemWithCategory({\n  id,\n  name,\n  category,\n  completed,\n  listId,\n  customCategories,\n  recipeName,\n  onToggle,\n  onDelete,\n  onCategoryChange,\n  onAddCategory,\n  onDeleteCategory,\n  isViewer = false,\n}: ListItemWithCategoryProps) {\n  const [showCategoryMenu, setShowCategoryMenu] = useState(false);\n  const [updatingCategory, setUpdatingCategory] = useState(false);\n  const [newCategoryInput, setNewCategoryInput] = useState('');\n  const menuRef = useRef<HTMLDivElement>(null);\n  const buttonRef = useRef<HTMLButtonElement>(null);\n\n  // Schließe Menü wenn außerhalb geklickt\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      if (buttonRef.current) {\n        const isClickOnButton = buttonRef.current.contains(e.target as Node);\n        const isClickOnMenu = (e.target as Node).nodeType === 1 && \n          (e.target as HTMLElement).closest('[data-category-menu]');\n        \n        if (!isClickOnMenu && !isClickOnButton && showCategoryMenu) {\n          setShowCategoryMenu(false);\n        }\n      }\n    };\n\n    if (showCategoryMenu) {\n      document.addEventListener('click', handleClickOutside);\n    }\n    return () => document.removeEventListener('click', handleClickOutside);\n  }, [showCategoryMenu]);\n\n  const handleCategorySelect = async (newCategory: string | null) => {\n    setUpdatingCategory(true);\n    try {\n      await itemsApi.updateCategory(listId, id, newCategory);\n      // Also sync the category mapping for this item name\n      await lists.syncCategory(listId, name, newCategory);\n      setShowCategoryMenu(false);\n      setNewCategoryInput('');\n      onCategoryChange();\n    } catch (err) {\n      console.error('Fehler beim Aktualisieren der Kategorie:', err);\n    } finally {\n      setUpdatingCategory(false);\n    }\n  };\n\n  const handleAddNewCategory = async () => {\n    if (!newCategoryInput.trim()) return;\n    await handleCategorySelect(newCategoryInput.trim());\n    onAddCategory(newCategoryInput.trim());\n  };\n\n  const allCategories = [...DEFAULT_CATEGORIES, ...customCategories];\n  const uniqueCategories = [...new Set(allCategories)];\n\n  return (\n    <li\n      className=\"p-4 hover:bg-[#1a1a2e] flex items-center gap-4 transition-all group relative overflow-visible\"\n    >\n      <label className=\"flex items-center gap-4 flex-1 cursor-pointer min-w-0\">\n        <div className=\"relative flex-shrink-0\">\n          <input\n            type=\"checkbox\"\n            checked={completed}\n            onChange={() => !isViewer && onToggle(id, completed)}\n            disabled={isViewer}\n            className=\"peer w-6 h-6 cursor-pointer appearance-none bg-[#1a1a2e] border-2 border-[#2d2d3f] rounded-lg checked:bg-gradient-to-br checked:from-purple-500 checked:to-purple-600 checked:border-purple-500 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\n          />\n          <svg className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-4 h-4 text-white pointer-events-none opacity-0 peer-checked:opacity-100 transition-opacity\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={3} d=\"M5 13l4 4L19 7\" />\n          </svg>\n        </div>\n        <div className=\"flex-1 min-w-0\">\n          <span\n            className={`block transition-all truncate ${\n              completed ? 'text-gray-500 line-through' : 'text-gray-200'\n            }`}\n          >\n            {name}\n          </span>\n          {recipeName && (\n            <span className=\"text-xs text-blue-400 block mt-1\">Rezept: {recipeName}</span>\n          )}\n          {category && (\n            <span className=\"text-xs text-purple-400 block mt-1\">{category}</span>\n          )}\n        </div>\n      </label>\n\n      {/* Category Button */}\n      <div className=\"relative flex-shrink-0\">\n        <button\n          ref={buttonRef}\n          onClick={() => !isViewer && setShowCategoryMenu(!showCategoryMenu)}\n          disabled={isViewer}\n          className=\"p-2 text-gray-400 hover:text-purple-400 hover:bg-purple-500/10 rounded-lg transition-all opacity-100 sm:opacity-0 sm:group-hover:opacity-100 disabled:opacity-50 disabled:cursor-not-allowed\"\n          title=\"Kategorie ändern\"\n        >\n          <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z\" />\n          </svg>\n        </button>\n\n        {/* Category Menu - Fixed positioning to break out of overflow containers */}\n        {showCategoryMenu && buttonRef.current && (() => {\n          const rect = buttonRef.current.getBoundingClientRect();\n          return (\n            <div\n              ref={menuRef}\n              data-category-menu\n              onClick={(e) => e.stopPropagation()}\n              style={{\n                position: 'fixed',\n                top: `${rect.bottom + 8}px`,\n                right: `${window.innerWidth - rect.right}px`,\n              }}\n              className=\"bg-[#1a1a2e] border border-[#2d2d3f] rounded-lg shadow-2xl z-50 min-w-40 max-h-64 overflow-y-auto\"\n            >\n              <button\n                type=\"button\"\n                onClick={(e) => {\n                  e.preventDefault();\n                  e.stopPropagation();\n                  handleCategorySelect(null);\n                }}\n                disabled={updatingCategory}\n                className=\"w-full text-left px-4 py-2 text-gray-400 hover:text-white hover:bg-purple-500/10 transition-all text-sm border-b border-[#2d2d3f] disabled:opacity-50\"\n              >\n                Keine Kategorie\n              </button>\n              {uniqueCategories.map((cat) => (\n                <div key={cat} className=\"border-b border-[#2d2d3f] flex items-center group\">\n                  <button\n                    type=\"button\"\n                    onClick={(e) => {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      handleCategorySelect(cat);\n                    }}\n                    disabled={updatingCategory}\n                    className={`flex-1 text-left px-4 py-2 transition-all text-sm disabled:opacity-50 ${\n                      category === cat\n                        ? 'bg-purple-500/20 text-purple-300'\n                        : 'text-gray-400 hover:text-white hover:bg-purple-500/10'\n                    }`}\n                  >\n                    {cat}\n                  </button>\n                  <button\n                    type=\"button\"\n                    onClick={(e) => {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      if (confirm(`Kategorie \"${cat}\" löschen?`)) {\n                        onDeleteCategory(cat);\n                      }\n                    }}\n                    className=\"text-red-400 hover:text-red-300 p-2 opacity-0 group-hover:opacity-100 hover:bg-red-500/20 rounded transition-all mx-1\"\n                    title=\"Kategorie löschen\"\n                  >\n                    <svg className=\"w-4 h-4\" fill=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path d=\"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z\" />\n                    </svg>\n                  </button>\n                </div>\n              ))}\n              <div className=\"px-4 py-3 border-t border-[#2d2d3f] bg-[#0a0a0f]\">\n                <input\n                  type=\"text\"\n                  placeholder=\"Neue Kategorie\"\n                  value={newCategoryInput}\n                  onChange={(e) => {\n                    e.stopPropagation();\n                    setNewCategoryInput(e.target.value);\n                  }}\n                  onKeyDown={(e) => {\n                    e.stopPropagation();\n                    if (e.key === 'Enter') handleAddNewCategory();\n                  }}\n                  className=\"w-full bg-[#1a1a2e] border border-[#2d2d3f] rounded px-3 py-2 text-sm text-white placeholder-gray-500 focus:outline-none focus:border-purple-500\"\n                />\n                <button\n                  type=\"button\"\n                  onClick={(e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    handleAddNewCategory();\n                  }}\n                  disabled={updatingCategory || !newCategoryInput.trim()}\n                  className=\"w-full mt-2 px-3 py-1 bg-purple-500/20 hover:bg-purple-500/30 text-purple-300 text-sm rounded transition-all disabled:opacity-50\"\n                >\n                  Hinzufügen\n                </button>\n              </div>\n            </div>\n          );\n        })()}\n      </div>\n\n      {/* Delete Button */}\n      <button\n        onClick={() => !isViewer && onDelete(id)}\n        disabled={isViewer}\n        className=\"p-2 text-red-400 hover:text-red-300 hover:bg-red-500/20 rounded-lg transition-all opacity-100 sm:opacity-0 sm:group-hover:opacity-100 flex-shrink-0 disabled:opacity-50 disabled:cursor-not-allowed\"\n        title=\"Löschen\"\n      >\n        <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n          <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16\" />\n        </svg>\n      </button>\n    </li>\n  );\n}\n"],"names":[],"mappings":"uDAEA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA,MCEA,OAAM,EACI,gBAA0C,IAAK,CAC/C,OAAwB,IAAK,CAC7B,UAA8B,IAAI,GAAM,CACxC,kBAAoB,CAAE,CACtB,qBAAuB,CAAE,CACzB,eAAiB,GAAK,CACtB,YAAa,CAAM,CAEpB,UAAU,CAAc,CAAE,CAAqB,CAAc,CASlE,OARA,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,GAGf,IAAI,CAAC,MAAM,GAAK,GAAW,IAAI,CAAC,EAAN,aAAqB,EAAE,AACnD,IAAI,CAAC,OAAO,CAAC,GAIR,KACL,IAAI,CAAC,SAAS,CAAC,MAAM,CAAC,GAElB,AAAwB,GAAG,KAAvB,CAAC,SAAS,CAAC,IAAI,EACrB,IAAI,CAAC,UAAU,EAEnB,CACF,CAEA,MAAc,QAAQ,CAAc,CAAiB,CAInD,GAHA,IAAI,CAAC,MAAM,CAAG,EAGV,IAAI,CAAC,eAAe,EAAI,CAAC,IAAI,CAAC,UAAU,CAAE,CAC5C,IAAI,CAAC,UAAU,EAAG,EAClB,GAAI,CAE0C,AAAxC,OAA+C,EAA3C,CAAC,eAAe,CAAC,MAAM,CAAC,OAAO,EACrC,IAAI,CAAC,eAAe,CAAC,KAAK,EAE9B,CAAE,MAAO,EAAO,CAEd,QAAQ,KAAK,CAAC,uCAAwC,aAAiB,MAAQ,EAAM,OAAO,CAAG,OAAO,GACxG,CACA,IAAI,CAAC,UAAU,EAAG,CACpB,CAEA,IAAI,CAAC,eAAe,CAAG,IAAI,gBAK3B,IAAM,EAAM,GAAG,QAAQ,GAAa,OAAO,CAAT,GAAkB,CAEpD,GAFmD,KAE3C,GAAG,CAAC,wCAAyC,GAErD,GAAI,CACF,IAAM,EAAW,MAAM,MAAM,EAAK,CAChC,OAAQ,MACR,QAAS,CACP,cAAiB,CAAC,OAAO,EAAE,GAC7B,EACA,EAFoC,KAE5B,IAAI,CAAC,eAAe,CAAC,MAC/B,AADqC,GAKrC,GAFA,QAAQ,GAAG,CAAC,gCAAiC,EAAS,MAAM,CAAE,EAAS,UAAU,EAE7E,CAAC,EAAS,EAAE,CAAE,CAChB,IAAM,EAAY,MAAM,EAAS,IAAI,GACrC,QAAQ,KAAK,CAAC,2BAA4B,EAAS,MAAM,CAAE,GAC3D,IAAI,CAAC,qBAAqB,GAC1B,MACF,CAEA,GAAI,CAAC,EAAS,IAAI,CAAE,CAClB,QAAQ,KAAK,CAAC,iCACd,IAAI,CAAC,qBAAqB,GAC1B,MACF,CAEA,QAAQ,GAAG,CAAC,iCAAkC,GAC9C,MAAM,IAAI,CAAC,UAAU,CAAC,EAAS,IAAI,CACrC,CAAE,MAAO,EAAO,CACV,aAAiB,OAAS,AAAe,cAAc,GAAvB,IAAI,CACtC,QAAQ,GAAG,CAAC,mCACH,aAAiB,WAAa,EAAM,OAAO,CAAC,QAAQ,CAAC,oBAE9D,CAFmF,OAE3E,GAAG,CAAC,gDAEZ,QAAQ,KAAK,CAAC,iCAAkC,GAChD,IAAI,CAAC,qBAAqB,GAE9B,CACF,CAEA,MAAc,WAAW,CAAgC,CAAiB,CACxE,IAAM,EAAS,EAAK,SAAS,GACvB,EAAU,IAAI,YAChB,EAAS,GAEb,GAAI,CACF,MAAO,CAAM,CAEX,GAAI,IAAI,CAAC,eAAe,EAAE,OAAO,QAAS,CACxC,QAAQ,GAAG,CAAC,8CACZ,KACF,CAEA,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAO,IAAI,GACzC,GAAI,EAAM,CACR,QAAQ,GAAG,CAAC,6BACZ,IAAI,CAAC,qBAAqB,GAC1B,KACF,CAGA,IAAM,EAAQ,CADd,GAAU,EAAQ,MAAM,CAAC,EAAO,CAAE,QAAQ,CAAK,EAAA,EAC1B,KAAK,CAAC,MAK3B,IAAK,IAAM,KAFX,EAAS,EAAM,GAAG,IAAM,GAEL,GACjB,GAAI,AADoB,EACf,UAAU,CAAC,UAAW,CAC7B,IAAM,EAAO,EAAK,KAAK,CAAC,GACxB,GAAI,CACF,IAAM,EAAsB,KAAK,KAAK,CAAC,GACvC,IAAI,CAAC,oBAAoB,CAAC,GAG1B,IAAI,CAAC,iBAAiB,CAAG,CAC3B,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,wCAAyC,EAAO,OAAQ,EACxE,CACF,CAEJ,CACF,CAAE,MAAO,EAAO,CAEd,GAAI,aAAiB,OAAO,AAC1B,GAAmB,eAAf,EAAM,IAAI,EAAqB,EAAM,OAAO,CAAC,QAAQ,CAAC,WAAY,YACpE,QAAQ,GAAG,CAAC,yCAEP,GAAI,EAAM,OAAO,CAAC,QAAQ,CAAC,oBAAqB,YACrD,QAAQ,GAAG,CAAC,oDAEd,CAEF,QAAQ,KAAK,CAAC,kCAAmC,GACjD,IAAI,CAAC,qBAAqB,EAC5B,QAAU,CACR,GAAI,CACF,EAAO,WAAW,EACpB,CAAE,MAAO,EAAO,CAEd,QAAQ,KAAK,CAAC,qDAAsD,aAAiB,MAAQ,EAAM,OAAO,CAAG,OAAO,GACtH,CACF,CACF,CAEQ,uBAA8B,CAEpC,GAAI,IAAI,CAAC,iBAAiB,CAAG,IAAI,CAAC,oBAAoB,EAAI,IAAI,CAAC,MAAM,CAAE,CACrE,IAAM,EAAQ,IAAI,CAAC,cAAc,CAAG,KAAK,GAAG,CAAC,EAAG,IAAI,CAAC,iBAAiB,EACtE,QAAQ,GAAG,CAAC,gHAEZ,WAAW,KACT,IAAI,CAAC,iBAAiB,GAClB,IAAI,CAAC,MAAM,EAAE,AACf,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAE5B,EAAG,EACL,MACE,CADK,OACG,KAAK,CAAC,qEAElB,CAEQ,qBAAqB,CAAmB,CAAQ,CACtD,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,AAAC,IACtB,GAAI,CACF,EAAS,EACX,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,kCAAmC,EACnD,CACF,EACF,CAEO,YAAmB,CACxB,GAAI,IAAI,CAAC,eAAe,EAAI,CAAC,IAAI,CAAC,UAAU,CAAE,CAC5C,IAAI,CAAC,UAAU,CAAG,GAClB,GAAI,CACE,AAAwC,OAAO,EAA3C,CAAC,eAAe,CAAC,MAAM,CAAC,OAAO,EACrC,IAAI,CAAC,eAAe,CAAC,KAAK,EAE9B,CAAE,MAAO,EAAO,CAEd,QAAQ,KAAK,CAAC,kDAAmD,aAAiB,MAAQ,EAAM,OAAO,CAAG,OAAO,GACnH,CACA,IAAI,CAAC,UAAU,EAAG,EAClB,IAAI,CAAC,eAAe,CAAG,IACzB,CACA,IAAI,CAAC,MAAM,CAAG,KACd,IAAI,CAAC,SAAS,CAAC,KAAK,GACpB,IAAI,CAAC,iBAAiB,CAAG,EACzB,QAAQ,GAAG,CAAC,4BACd,CAEO,aAAuB,CAC5B,OAAgC,OAAzB,IAAI,CAAC,eAAe,AAC7B,CACF,CAGO,IAAM,EAAa,IAAI,EC1Mf,SAAS,EAAe,CAAE,QAAM,SAAE,CAAO,CAAuB,EAC7E,GAAM,CAAC,EAAmB,EAAqB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAiB,EAAE,EACvE,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC7B,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACjC,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACjC,CAAC,EAAgB,EAAkB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAE/C,CAAC,EAAgB,EAAkB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC/C,CAAC,EAAY,EAAc,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAsB,UAC5D,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAEzC,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,IACA,GACF,EAAG,CAAC,EAAO,EAEX,IAAM,EAAiB,UACrB,GAAI,CACF,EAAkB,IAClB,GAAM,CAAC,EAAI,EAAK,CAAG,MAAM,QAAQ,GAAG,CAAC,CACnC,EAAA,IAAI,CAAC,EAAE,GACP,EAAA,KAAK,CAAC,OAAO,CAAC,GACf,EACD,EAAW,EAAG,EAAE,GAAK,EAAK,OAAO,CACnC,CAAE,MAAO,EAAK,CACZ,QAAQ,KAAK,CAAC,6BAA8B,GAC5C,GAAW,EACb,QAAU,CACR,EAAkB,GACpB,CACF,EAEM,EAAqB,UACzB,GAAI,CACF,GAAW,GACX,IAAM,EAAO,MAAM,EAAA,aAAa,CAAC,MAAM,CAAC,GACxC,EAAqB,EACvB,CAAE,MAAO,EAAK,CACZ,EAAS,aAAe,MAAQ,EAAI,OAAO,CAAG,wCAC9C,QAAQ,KAAK,CAAC,EAChB,QAAU,CACR,EAAW,GACb,CACF,EAEM,EAAe,MAAO,IAK1B,GAJA,EAAE,cAAc,GAChB,EAAS,IACT,EAAW,IAEP,CAAC,EAAe,IAAI,GAAI,YAC1B,EAAS,6BAIX,GAAY,GACZ,GAAI,CAEF,MAAM,EAAA,aAAa,CAAC,MAAM,CAAC,EAAQ,EAAgB,GACnD,EAAW,oCACX,EAAkB,IAClB,EAAc,UAEd,WAAW,IAAM,IAAsB,IACzC,CAAE,MAAO,EAAK,CACZ,EAAS,aAAe,MAAQ,EAAI,OAAO,CAAG,sCAChD,QAAU,CACR,GAAY,EACd,CACF,EAEM,EAA2B,MAAO,IACtC,GAAK,CAAD,OAAS,4BAEb,CAF0C,EAEtC,CACF,MAAM,EAAA,aAAa,CAAC,MAAM,CAAC,EAAQ,GACnC,EAAW,mBACX,GACF,CAAE,MAAO,EAAK,CACZ,EAAS,aAAe,MAAQ,EAAI,OAAO,CAAG,wBAChD,CACF,EAEA,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gGACb,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wKACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,gBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mDACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,yCAAgC,iBAC9C,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,EACT,UAAU,+DACX,aAKF,GACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,kHACZ,IAIJ,GACC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wHACZ,IAIJ,CAAC,GAAkB,CAAC,GACnB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,2HAAkH,kFAMlI,GACC,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,SAAU,EAAc,UAAU,oDACtC,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,wDAA+C,iBAChE,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,KAAK,OACL,MAAO,EACP,SAAU,AAAC,GAAM,EAAkB,EAAE,MAAM,CAAC,KAAK,EACjD,YAAY,eACZ,UAAU,4MACV,QAAQ,CAAA,CAAA,IAGV,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CAAM,UAAU,wDAA+C,iBAChE,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACC,MAAO,EACP,SAAU,AAAC,GAAM,EAAc,EAAE,MAAM,CAAC,KAAK,EAC7C,UAAU,iMAEV,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAM,kBAAS,2BACvB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,MAAM,kBAAS,+BAGzB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,KAAK,SACL,SAAU,EACV,UAAU,+OAET,EAAW,qBAAuB,gBAMzC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,CAAG,UAAU,iDAAuC,mBAClC,EAAkB,MAAM,CAAC,OAG3C,EACC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCAAwB,YACN,IAA7B,EAAkB,MAAM,CAC1B,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCAAwB,yBAErC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8CACZ,EAAkB,GAAG,CAAC,AAAC,GACtB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAEC,UAAU,sGAEV,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,0CAAkC,EAAO,QAAQ,GAC9D,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCACM,AAAhB,aAAO,IAAI,CAAgB,aAAe,kBAG/C,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,IAAM,EAAyB,EAAO,EAAE,EACjD,UAAU,iFACV,MAAM,qBAEN,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,qBACjE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,uIAfpE,EAAO,EAAE,cA2BlC,CC1LA,IAAM,EAA+B,EAAE,CAExB,SAAS,EAAqB,IAC3C,CAAE,MACF,CAAI,UACJ,CAAQ,WACR,CAAS,QACT,CAAM,kBACN,CAAgB,YAChB,CAAU,UACV,CAAQ,UACR,CAAQ,kBACR,CAAgB,eAChB,CAAa,CACb,kBAAgB,UAChB,GAAW,CAAK,CACU,EAC1B,IAqGc,EArGR,CAAC,EAAkB,EAAoB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACnD,CAAC,EAAkB,EAAoB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACnD,CAAC,EAAkB,EAAoB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACnD,EAAU,CAAA,EAAA,EAAA,MAAM,AAAN,EAAuB,MACjC,EAAY,CAAA,EAAA,EAAA,MAAA,AAAM,EAAoB,MAG5C,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACR,IAAM,EAAqB,AAAC,IAC1B,GAAI,EAAU,OAAO,CAAE,CACrB,IAAM,EAAkB,EAAU,OAAO,CAAC,QAAQ,CAAC,EAAE,MAAM,CAIvD,CAHkD,AAGjD,IAHkB,EAAE,MAAM,CAAU,IAGnB,IAH2B,EAC9C,EAAE,MAAM,CAAiB,OAAO,CAAC,yBAEb,IAAmB,GACxC,GAAoB,EAExB,CACF,EAKA,OATgE,AAM5D,GACF,SAAS,MADW,UACK,CAAC,QAAS,GAE9B,IAAM,SAAS,mBAAmB,CAAC,QAAS,EACrD,EAAG,CAAC,EAAiB,EAErB,IAAM,EAAuB,MAAO,IAClC,GAAoB,GACpB,GAAI,CACF,MAAM,EAAA,KAAQ,CAAC,cAAc,CAAC,EAAQ,EAAI,GAE1C,MAAM,EAAA,KAAK,CAAC,YAAY,CAAC,EAAQ,EAAM,GACvC,GAAoB,GACpB,EAAoB,IACpB,GACF,CAAE,MAAO,EAAK,CACZ,QAAQ,KAAK,CAAC,2CAA4C,EAC5D,QAAU,CACR,GAAoB,EACtB,CACF,EAEM,EAAuB,UACtB,EAAiB,IAAI,IAAI,CAC9B,MAAM,EAAqB,EAAiB,IAAI,IAChD,EAAc,EAAiB,IAAI,IACrC,EAGM,EAAmB,IAAI,IAAI,IAAI,AADf,IAAI,KAAuB,EAAiB,EACd,CAEpD,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,CACC,UAAU,0GAEV,CAAA,EAAA,EAAA,IAAA,EAAC,QAAA,CAAM,UAAU,kEACf,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mCACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,KAAK,WACL,QAAS,EACT,SAAU,IAAM,CAAC,GAAY,EAAS,EAAI,GAC1C,SAAU,EACV,UAAU,mQAEZ,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,2JAA2J,KAAK,OAAO,OAAO,eAAe,QAAQ,qBAClN,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,wBAGzE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2BACb,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CACC,UAAW,CAAC,8BAA8B,EACxC,EAAY,6BAA+B,gBAAA,CAC3C,UAED,IAEF,GACC,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,UAAU,6CAAmC,WAAS,KAE7D,GACC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,8CAAsC,UAM5D,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mCACb,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,IAAK,EACL,QAAS,IAAM,CAAC,GAAY,EAAoB,CAAC,GACjD,SAAU,EACV,UAAU,+LACV,MAAM,4BAEN,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,qBACjE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,qIAKxE,GAAoB,EAAU,OAAO,IAAI,CAAC,AAC5B,EAAU,OAAO,CAAC,qBAAqB,GAElD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CACC,IAAK,EACL,oBAAkB,CAAA,CAAA,EAClB,QAAS,AAAC,GAAM,EAAE,eAAe,GACjC,MAAO,CACL,SAAU,QACV,IAAK,CAAA,EAAG,EAAK,MAAM,CAAG,EAAE,EAAE,CAAC,CAC3B,MAAO,CAAA,EAAG,OAAO,UAAU,CAAG,EAAK,KAAK,CAAC,EAAE,CAAC,AAC9C,EACA,UAAU,8GAEV,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,KAAK,SACL,QAAS,AAAC,IACR,EAAE,cAAc,GAChB,EAAE,eAAe,GACjB,EAAqB,KACvB,EACA,SAAU,EACV,UAAU,iKACX,oBAGA,EAAiB,GAAG,CAAC,AAAC,GACrB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAc,UAAU,8DACvB,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,KAAK,SACL,QAAS,AAAC,IACR,EAAE,cAAc,GAChB,EAAE,eAAe,GACjB,EAAqB,EACvB,EACA,SAAU,EACV,UAAW,CAAC,sEAAsE,EAChF,IAAa,EACT,mCACA,wDAAA,CACJ,UAED,IAEH,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,KAAK,SACL,QAAU,AAAD,IACP,EAAE,cAAc,GAChB,EAAE,eAAe,GACb,QAAQ,CAAC,WAAW,EAAE,EAAI,aAAU,CAAC,GAAG,AAC1C,EAAiB,EAErB,EACA,UAAU,wHACV,MAAM,6BAEN,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,UAAU,KAAK,eAAe,QAAQ,qBACnD,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,EAAE,wHA9BJ,IAmCZ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,6DACb,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACC,KAAK,OACL,YAAY,iBACZ,MAAO,EACP,SAAU,AAAC,IACT,EAAE,eAAe,GACjB,EAAoB,EAAE,MAAM,CAAC,KAAK,CACpC,EACA,UAAW,AAAC,IACV,EAAE,eAAe,GACH,UAAV,EAAE,GAAG,EAAc,GACzB,EACA,UAAU,qJAEZ,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,KAAK,SACL,QAAS,AAAC,IACR,EAAE,cAAc,GAChB,EAAE,eAAe,GACjB,GACF,EACA,SAAU,GAAoB,CAAC,EAAiB,IAAI,GACpD,UAAU,4IACX,yBAUX,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACC,QAAS,IAAM,CAAC,GAAY,EAAS,GACrC,SAAU,EACV,UAAU,sMACV,MAAM,mBAEN,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,qBACjE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,uIAK/E,CH3Me,SAAS,IACpB,MAAM,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,EAAS,CAAA,EAAA,EAAA,SAAA,AAAS,IAClB,EAAS,GAAQ,OAEjB,CAAC,EAAM,EAAQ,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAc,MACxC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAiB,EAAE,EACvC,CAAC,EAAa,EAAe,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IACzC,CAAC,EAAS,EAAW,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAS,IACjC,CAAC,EAAO,EAAS,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,IAC7B,CAAC,EAAgB,EAAkB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GAC/C,CAAC,EAAkB,EAAoB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAW,EAAE,EAC/D,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACnC,CAAC,EAAU,EAAY,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAW,CAAE,QAAS,GAAO,UAAU,EAAM,UAAU,CAAM,GAC/F,CAAC,EAAiB,EAAmB,CAAG,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAwB,MAChE,CAAC,EAAqB,EAAuB,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,GAAC,GACzD,CAAC,EAAyB,EAA2B,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAsB,MACtF,CAAC,EAAQ,EAAU,CAAG,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAgB,MAEpD,CAAA,EAAA,EAAA,SAAS,AAAT,EAAU,KACN,GAAY,EAChB,EAAG,EAAE,EAEL,CAAA,EAAA,EAAA,SAAA,AAAS,EAAC,KACN,GAAI,CAAC,GAAY,CAAC,EAAQ,OAC1B,IAGA,IAAM,EAAY,OAAO,GACnB,EAAc,EAAW,SAAS,CAAC,EAAW,AAAC,IAE7C,AAAiB,oBAAoB,GAA7B,IAAI,EACZ,QAAQ,GAAG,CAAC,CAAC,2BAA2B,EAAE,EAAQ,QAAQ,CAAC,IAAI,EAAE,EAAQ,QAAQ,CAAA,CAAE,EAEnF,EAAoB,GAChB,AAAI,EAAQ,QAAQ,EAAI,CAAC,EAAK,QAAQ,CAAC,EAAQ,QAAQ,EAC5C,CAD+C,GAC3C,EAAM,EAAQ,QAAQ,CAAC,CAAC,IAAI,GAEpC,IAEa,aAAa,CAA9B,EAAQ,IAAI,GAEnB,QAAQ,GAAG,CAAC,CAAC,KAAK,EAAE,EAAO,0BAA0B,CAAC,EACtD,IAER,GAEA,MAAO,KACH,GACJ,CACJ,EAAG,CAAC,EAAQ,EAAS,EAErB,IAAM,EAAY,UACd,GAAI,CACA,GAAW,GACX,IAAM,EAAa,OAAO,GAEpB,EAAW,MAAM,EAAA,KAAK,CAAC,OAAO,CAAC,GACrC,EAAQ,GAGR,GAAI,CACA,IAAM,EAAK,MAAM,EAAA,IAAI,CAAC,EAAE,GACxB,GAAI,EAAI,CACJ,EAAU,EAAG,EAAE,EACf,IAAM,EAAU,MAAM,EAAA,aAAa,CAAC,MAAM,CAAC,GACrC,EAAU,EAAS,OAAO,GAAK,EAAG,EAAE,CACpC,EAAe,GAAS,KAAK,AAAC,GAAW,EAAE,MAAM,GAAK,EAAG,EAAE,EACjE,EAA2B,GAAgB,MAC3C,IAAM,EAAW,GAAc,OAAS,SAClC,EAAW,GAAc,OAAS,UAAa,CAAC,GAAW,GAAc,OAAS,SAExF,EAAY,SAAE,WAAS,WAAU,CAAS,EAC9C,CACJ,CAAE,MAAO,EAAK,CACV,QAAQ,GAAG,CAAC,8CACZ,EAAY,CAAE,SAAS,EAAO,UAAU,EAAM,UAAU,CAAM,EAClE,CAEA,IAAM,EAAY,MAAM,EAAA,KAAQ,CAAC,MAAM,CAAC,GACxC,EAAS,GAGT,GAAI,CACA,IAAM,EAAa,MAAM,EAAA,KAAK,CAAC,aAAa,CAAC,GAC7C,EAAoB,EACxB,CAAE,MAAO,EAAK,CAEV,IAAM,EAAa,EACd,MAAM,CAAC,AAAC,GAAc,EAAK,QAAQ,EACnC,GAAG,CAAC,AAAC,GAAc,EAAK,QAAQ,EAChC,MAAM,CAAC,CAAC,EAAa,EAAe,IAAmB,EAAK,OAAO,CAAC,KAAS,GAElF,EAAoB,EACxB,CACJ,CAAE,MAAO,EAAK,CACV,IAAM,EAAe,aAAe,MAAQ,EAAI,OAAO,CAAG,mBAEtD,CAAC,EAAa,QAAQ,CAAC,cAAc,AACrC,EAAS,GAEb,QAAQ,KAAK,CAAC,EAClB,QAAU,CACN,GAAW,EACf,CACJ,EAEM,EAAkB,UACpB,GAAI,AAAC,GAAW,GAEX,IAFU,IAEF,cAF4B,iCAMzC,CAJ6D,EAIzD,CACA,MAAM,EAAA,aAAa,CAAC,MAAM,CAAC,OAAO,GAAS,EAAwB,EAAE,EACrE,EAAO,IAAI,CAAC,aAChB,CAAE,MAAO,EAAK,CAEV,EADqB,OACZ,MAD2B,MAAQ,EAAI,OAAO,CAAG,kCAE9D,CACJ,EAEM,EAAyB,UAC3B,GAAI,AAAC,GAAW,EAEhB,GAAI,CACA,CAHW,GAGL,EAAU,MAAM,EAAA,KAHe,QAGF,CAAC,MAAM,CAAC,OAAO,GAAS,EAAwB,EAAE,EACrF,EAA2B,GAC3B,EAAS,GACb,CAAE,MAAO,EAAK,CAEV,EADqB,OACZ,MAD2B,MAAQ,EAAI,OAAO,CAAG,wCAE9D,CACJ,EAEM,EAAgB,MAAO,IAEzB,GADA,EAAE,cAAc,GACZ,AAAC,EAAY,IAAI,IAAO,EAAD,CAE3B,GAAI,EAFgC,AAEvB,QAAQ,CAAE,YACnB,EAAS,oEAIb,GAAI,CACA,MAAM,EAAA,KAAQ,CAAC,MAAM,CAAC,OAAO,GAAS,GACtC,EAAe,IACf,GACJ,CAAE,MAAO,EAAK,CACV,IAAM,EAAe,aAAe,MAAQ,EAAI,OAAO,CAAG,yBACtD,EAAa,QAAQ,CAAC,aACtB,CADoC,CAC3B,0CAET,EAAS,EAEjB,EACJ,EAEM,EAAmB,MAAO,EAAgB,KAC5C,GAAK,CAAD,CAEJ,GAAI,CACA,EAHS,IAGH,EAAA,KAAQ,CAAC,MAAM,CAAC,OAAO,GAAS,EAAQ,CAAC,GAC/C,GACJ,CAAE,MAAO,EAAK,CACV,EAAS,aAAe,MAAQ,EAAI,OAAO,CAAG,4BAClD,CACJ,EAEM,EAAmB,MAAO,IAC5B,GAAK,CAAD,CAEJ,GAAI,CACA,EAHS,IAGH,EAAA,KAAQ,CAAC,MAAM,CAAC,OAAO,GAAS,GACtC,GACJ,CAAE,MAAO,EAAK,CACV,EAAS,aAAe,MAAQ,EAAI,OAAO,CAAG,sBAClD,CACJ,EAEM,EAAqB,AAAD,IAClB,AAAC,EAAiB,QAAQ,CAAC,IAC3B,EAAoB,IAAI,EAAkB,EAAa,CADb,AAGlD,EAEM,EAAuB,MAAO,IAChC,GAAK,CAAD,CAEJ,GAAI,CACA,EAHS,IAGH,EAAA,KAAK,CAAC,cAAc,CAAC,OAAO,GAAS,GAC3C,EAAoB,EAAiB,MAAM,CAAC,GAAO,IAAQ,IAC3D,GACJ,CAAE,MAAO,EAAK,CACV,EAAS,aAAe,MAAQ,EAAI,OAAO,CAAG,oCAClD,CACJ,EAQM,EAAyB,AAAC,IAC5B,EAAE,cAAc,GAChB,EAAE,YAAY,CAAC,UAAU,CAAG,MAChC,EAEM,EAAqB,MAAO,EAAoC,KAElE,GADA,EAAE,cAAc,GACZ,CAAC,GAAmB,IAAoB,GAAkB,EAAS,QAAQ,CAAE,YAC7E,EAAmB,MAIvB,IAAM,EAAe,EAAiB,OAAO,CAAC,GACxC,EAAc,EAAiB,OAAO,CAAC,GAE7C,GAAqB,CAAC,IAAlB,GAAuC,CAAC,IAAjB,EAAoB,YAC3C,EAAmB,MAIvB,IAAM,EAAgB,IAAI,EAAiB,CAC3C,EAAc,MAAM,CAAC,EAAc,GACnC,EAAc,MAAM,CAAC,EAAa,EAAG,GAErC,EAAoB,GACpB,EAAmB,MAGnB,GAAuB,GACvB,GAAI,CACA,MAAM,EAAA,KAAK,CAAC,mBAAmB,CAAC,OAAO,GAAS,EACpD,CAAE,MAAO,EAAK,CAEV,EAAoB,GACpB,EAAS,aAAe,MAAQ,EAAI,OAAO,CAAG,kDAClD,QAAU,CACN,GAAuB,EAC3B,CACJ,SAEK,AAAL,EASI,CAAA,CATA,CASA,CATO,CASP,IAAA,EAAC,MAAA,CAAI,UAAU,oDAEX,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CAAO,UAAU,uFACd,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,wDACX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,0EACX,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACG,QAAS,IAAM,EAAO,IAAI,CAAC,cAC3B,UAAU,4JAEV,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,0DAA0D,KAAK,OAAO,OAAO,eAAe,QAAQ,qBAC/G,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,sBAEzE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,4BAAmB,qBACnC,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,qBAAY,cAEhC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,8CACV,GAA8D,YAAnC,EAAwB,MAAM,EACtD,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACG,QAAS,EACT,UAAU,kIACV,MAAM,kCAEN,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,qBAC/D,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,qBAEzE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,4BAAmB,mBAG1C,GAA2B,CAAC,EAAS,OAAO,EACzC,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACG,QAAS,EACT,UAAU,8HACV,MAAM,4BAEN,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,qBAC/D,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,gGAEzE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,4BAAmB,iBAG1C,EAAS,OAAO,EACb,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACG,QAAS,IAAM,GAAkB,GACjC,UAAU,oIACV,MAAM,yBAEN,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,qBAC/D,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,uCAEzE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,4BAAmB,oBAKnD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,2DACX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,+BACX,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,qIAA6H,EAAK,KAAK,GACpJ,EAAK,WAAW,EACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,yDAAiD,EAAK,WAAW,aAQlG,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,gGACZ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,6BACd,GACG,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oLACX,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,8BAAsB,IACtC,CAAA,EAAA,EAAA,GAAA,EAAC,SAAA,CACG,QAAS,IAAM,EAAS,IACxB,UAAU,wEACb,SAOT,CAAA,EAAA,EAAA,IAAA,EAAC,OAAA,CAAK,SAAU,EAAe,UAAU,gCACrC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,gCACX,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,2BACX,CAAA,EAAA,EAAA,GAAA,EAAC,QAAA,CACG,KAAK,OACL,MAAO,EACP,SAAU,AAAC,GAAM,EAAe,EAAE,MAAM,CAAC,KAAK,EAC9C,YAAY,8BACZ,SAAU,EAAS,QAAQ,CAC3B,UAAU,8RAGlB,CAAA,EAAA,EAAA,IAAA,EAAC,SAAA,CACG,KAAK,SACL,SAAU,EAAS,QAAQ,CAC3B,UAAU,kZAEV,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,wBAAwB,KAAK,OAAO,OAAO,eAAe,QAAQ,qBAC7E,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,EAAG,EAAE,qBAEzE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,UAAU,4BAAmB,qBAG1C,EAAS,QAAQ,EACd,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,mDAA0C,yCAK7C,IAAjB,EAAM,MAAM,CACT,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,uIACX,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,8DAAqD,mBACnE,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,4CAAmC,wCAGpD,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,0CACV,AAUG,CAVF,MAUS,IAAI,CARL,AAQM,EARI,EAAM,MAAM,CAAC,CAAC,EAAU,KACpC,IAAM,EAAM,EAAK,QAAQ,EAAI,iBAG7B,OAFI,AAAC,CAAG,CAAC,EAAI,GAAE,CAAG,CAAC,EAAI,CAAG,EAAA,AAAE,EAC5B,CAAG,CAAC,EAAI,CAAC,IAAI,CAAC,GACP,CACX,EAAG,CAAC,IAGiB,OAAO,CAAC,AAAC,IAC1B,CAAO,CAAC,EAAS,CAAC,IAAI,CAAC,CAAC,EAAS,IAC7B,AAAI,EAAE,SAAS,GAAK,EAAE,SAAS,CACpB,CADsB,CAG1B,EAAE,SAAS,CAAG,EAAI,CAAC,EAElC,GAGyB,AAkBlB,OAlByB,IAAI,CAAC,GAAS,IAAI,CAAC,CAAC,EAAG,KACnD,IAAM,EAAS,EAAiB,OAAO,CAAC,GAClC,EAAS,EAAiB,OAAO,CAAC,UAGxC,AAAe,CAAC,IAAZ,GAA4B,CAAC,GAAG,CAAf,EACV,EAAS,EAGL,CAAC,GAAG,CAAf,EAAsB,CAAC,EACZ,CAAC,GAAG,CAAf,GAGM,kBAAkB,CAAxB,EAHsB,EAIhB,EADyB,gBACP,CAAxB,EAA+B,CAAC,EAC7B,EAAE,aAAa,CAAC,EAC3B,GAEwB,GAAG,CAAC,AAAC,GACzB,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAEG,UAAU,8FACV,WAAY,EACZ,OAAQ,AAAC,GAAM,EAAmB,EAAG,aAErC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CACG,UAAW,CAAC,EAAS,QAAQ,CAC7B,YAAa,AAAC,IAAM,CA1NhD,EAAS,QAAQ,EAAE,CACvB,EAyN+E,GAAH,AAxN5E,EAAE,YADiB,AACL,CAAC,aAAa,CAAG,SAyNC,UAAW,CAAC,0GAA0G,EAClH,CAAC,EAAS,QAAQ,CAAG,qCAAuC,GAC/D,CAAC,EAAE,IAAoB,EAAW,8BAAgC,GAAA,CAAI,CACvE,MAAO,EAAS,QAAQ,CAAG,GAAK,6CAE/B,CAAC,EAAS,QAAQ,EACf,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sCAAsC,KAAK,eAAe,QAAQ,qBAC7E,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,EAAE,0FAGhB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,wDAAgD,OAElE,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,qCACT,CAAO,CAAC,EAAS,CAAC,GAAG,CAAC,AAAC,GACpB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAEG,GAAI,EAAK,EAAE,CACX,KAAM,EAAK,IAAI,CACf,SAAU,EAAK,QAAQ,CACvB,UAAW,EAAK,SAAS,CACzB,OAAQ,OAAO,GACf,iBAAkB,EAClB,WAAa,EAAa,UAAU,CACpC,SAAU,EACV,SAAU,EACV,iBAAkB,EAClB,cAAe,EACf,iBAAkB,EAClB,SAAU,EAAS,QAAQ,EAbtB,EAAK,EAAE,OAvBnB,YAiD5B,GAAkB,GACf,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CACG,OAAQ,OAAO,GACf,QAAS,IAAM,GAAkB,QAxNzC,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,sEACX,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCAAwB,0BA4NrD"}